### Setup for AWS using Terraform or Manually

This project provisions infrastructure on AWS using Terraform or Manually, to create:

- A default VPC (if none exists)
- An SSH key pair (generated by Terraform, saved locally)
- A security group that allows:
  - SSH (22)
  - HTTP (80)
  - HTTPS (443)
  - MQTT (1883)
  - An EC2 instance with:
  - GPU: g4dn.xlarge (NVIDIA T4) by default
  - 100GB EBS disk
  - Static Elastic IP for consistent public access

### How it works

1. Create a Default VPC (if doesnt exist already).
2. Generates an RSA SSH key pair (4096 bits), Saves your private key locally as: `artmograph.pem`

   - **Make sure to `chmod 600 artmograph.pem` and keep it secure.**

3. Creates a security group allowing inbound SSH, HTTP, HTTPS, and MQTT from anywhere.
4. Launches an EC2 instance in Mumbai (ap-south-1) region using Debian AMI.
5. Attaches a static Elastic IP to the instance.
6. Outputs your static public IP at the end.

### AWS Setup using Terraform (Manual Method is Below)

1. Install AWS CLI
   https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html

2. Configure AWS CLI with your credentials
   https://docs.aws.amazon.com/cli/latest/userguide/getting-started-quickstart.html
   (Make sure your IAM user has EC2 & VPC permissions.)

3. Install Terraform
   https://www.terraform.io/downloads.html

**Running it**

Be sure to be inside the terraform folder using the terminal

1. Initialize Terraform

`terraform init`

2. Preview the plan

`terraform plan`

3. Apply & create resources

`terraform apply`

Type yes when prompted.

If you get an error after `terraform apply`

Error: Error launching source instance:
InsufficientInstanceCapacity: We currently do not have sufficient g4dn.xlarge capacity in the Availability Zone you requested

or:

UnauthorizedOperation: Your account is not authorized to use the specified instance type.

This means you are not eligible to launch g4dn.xlarge (GPU) under your current account / free tier.

To fix:
Change your instance type to a cheaper, general-purpose CPU instance in the `main.tf`:

`instance_type = "t3.small"`

Then run:

`terraform apply`

**SSH into your EC2 instance**

Terraform will output:

`instance_static_ip = "X.X.X.X"`

SSH in using your key:

```chmod 600 artmograph.pem
ssh -i artmograph.pem ec2user@<instance_static_ip>
```

**Clean up**

When done, destroy everything to avoid AWS charges:

`terraform destroy`

### AWS Setup Using AWS Web Console (Terraform Method is Above)

**Step 1: Create a Key Pair in AWS Console**

1. Go to EC2 Console → Key Pairs.
2. Click Create Key Pair.
3. Set:
   - Name: artmograph-key
   - Key pair type: RSA
   - Private key file format: .pem
4. Click Create Key Pair.
   It will automatically download artmograph-key.pem to your computer.

**Important:**

- Keep this file safe and private.
- Run `chmod 600 artmograph-key.pem if you’re on macOS/Linux.`

**Step 2: Create the Security Group**

1. Go to EC2 Console → Security Groups → Create security group.
2. Set:

- Name: artmograph-security-group
- Description: Allow SSH, HTTP, HTTPS, MQTT
- VPC: Select your default VPC

3. Under Inbound rules, add:
   | Type | Protocol | Port | Source |
   |------------|----------|------|-----------|
   | SSH | TCP | 22 | 0.0.0.0/0 |
   | HTTP | TCP | 80 | 0.0.0.0/0 |
   | HTTPS | TCP | 443 | 0.0.0.0/0 |
   | Custom TCP | TCP | 1883 | 0.0.0.0/0 |

**You can restrict Source to your IP for SSH in production.**

4. Leave Outbound rules as All traffic / 0.0.0.0/0.
5. Click Create security group.

**Step 3: Launch the EC2 Instance**

1. Go to EC2 Console → Instances → Launch Instance.
2. Set:
   - Name: `Artmograph-Server`
3. Under Application and OS Images (AMI):
   - Choose _Debian_
4. Under Instance type:
   - _g4dn.xlarge_

If you see errors like InsufficientInstanceCapacity or UnauthorizedOperation or unable to find or select _g4dn.xlarge_, change to: _t3.small_ (cheap, general-purpose, wont perform well, lacks GPU).

5. Under Key pair (login):
   - Select: `artmograph-key` you created earlier.
6. Under Network settings:

- Select your default VPC
- Attach the _artmograph-security-group_.

7. Under Configure storage:
   - Set Root volume: 100 GB (gp3).

You can increase or decrease the size (not more then 45gb)

8. Click Launch Instance.

**Step 4: Allocate and Associate an Elastic IP**

1. Go to EC2 Console → Elastic IPs → Allocate Elastic IP.
2. Click Allocate.
3. Select the new Elastic IP → Actions → Associate Elastic IP.
4. Select your instance _Artmograph-Server_ → Associate.

Now your instance has a static IP.

**Step 5: SSH into your Instance**

Open Terminal

```
chmod 600 artmograph-key.pem
ssh -i artmograph-key.pem ec2@<your-elastic-ip>
```

**Clean up manually**

- Terminate the EC2 instance when done.
- Release the Elastic IP so AWS stops charging.
